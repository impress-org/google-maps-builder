!function(a){"use strict";function b(){d(),f(),g(),setTimeout(function(){a("body.iframe").css({height:"auto"})},200),a(".gpr-toggle-shortcode-fields").on("click",function(){a(".gpr-shortcode-hidden-fields-wrap").slideToggle()}),j===!0&&(a(".gpr-edit-shortcode").show(),a(".gpr-shortcode-hidden-fields-wrap").show(),a("#gpr_location_lookup_fields").hide(),a("#gpr_submit").val("Edit Shortcode"),c(i))}function c(b){var c=h(b.shortcode_params,"id"),d=h(b.shortcode_params,"title"),e=h(b.shortcode_params,"widget_style"),f=h(b.shortcode_params,"align"),g=h(b.shortcode_params,"max_width"),i=(h(b.shortcode_params,"review_limit"),h(b.shortcode_params,"cache")),j=h(b.shortcode_params,"review_filter"),k=h(b.shortcode_params,"review_char_limit"),l=h(b.shortcode_params,"pre_content"),m=h(b.shortcode_params,"post_content"),n=h(b.shortcode_params,"hide_header"),o=h(b.shortcode_params,"hide_google_image"),p=h(b.shortcode_params,"hide_out_of_rating"),q=h(b.shortcode_params,"target_blank"),r=h(b.shortcode_params,"no_follow");return c?(a("#gpr_widget_place_id").val(c),d&&a("#gpr_widget_title").val(d),e&&a("#gpr_widget_theme").val(e),f&&a("#gpr_widget_alignment").val(f),g&&a("#gpr_widget_maxwidth").val(g),j&&a("#gpr_widget_review_filter").val(j),k&&a("#gpr_widget_review_char_limit").val(k),l&&a("#gpr_widget_pre_content").val(l),m&&a("#gpr_widget_post_content").val(m),i&&a("#gpr_widget_cache").val(i),"true"==n&&a("#gpr_widget_hide_header").prop("checked",!0),"true"==o&&a("#gpr_widget_hide_google_image").prop("checked",!0),"true"==p&&a("#gpr_widget_hide_out_of_rating").prop("checked",!0),"false"==r&&a("#gpr_widget_no_follow").prop("checked",!1),void("false"==q&&a("#gpr_widget_target_blank").prop("checked",!1))):(alert("There was no Place ID found for this shortcode. Please create a new one."),!1)}function d(){var b=a(".gpr-autocomplete"),c=a(".gpr-types");b.each(function(d){var f=new google.maps.places.Autocomplete(b[d]);a(c).on("change",function(){var c=a(this).val();f.setTypes([c]),a(b).val("")}),e(f,b[d]),a(b).keydown(function(a){return 13==a.which?!1:void 0}),b.on("focus",function(){a(".place-id-set").slideUp(),a(this).val("")})})}function e(b,c){google.maps.event.addListener(b,"place_changed",function(){var d=b.getPlace();return d.place_id?(a(c).parentsUntil("form").find(".location").val(d.name),a(c).parents("form").find("input.gpr-place-id-hidden").val(d.place_id),a(c).parents("form").find(".place-id-set").slideDown(),a(c).parents("form").find(".place-id-not-set").hide(),void a(c).parents("form").find(".gpr-toggle-shortcode-fields").slideDown()):(alert("No place reference found for this location."),!1)})}function f(){a(".tooltip-info").tipsy({fade:!0,html:!0,gravity:"n",delayOut:1e3,delayIn:500})}function g(){a("#gpr_settings").on("submit",function(b){b.preventDefault();var c,d=top.tinymce.activeEditor.windowManager.getParams(),e=a('[name="gpr_widget_place_id"]').val(),f=a('[name="gpr_widget_title"]').val(),g=a('[name="gpr_widget_theme"]').val(),h=a('[name="gpr_widget_alignment"]').val(),i=a('[name="gpr_widget_maxwidth"]').val(),j=a('[name="gpr_widget_review_limit"]').val(),k=a('[name="gpr_widget_review_char_limit"]').val(),l=a('[name="gpr_widget_review_filter"]').val(),m=a('[name="gpr_widget_pre_content"]').val(),n=a('[name="gpr_widget_post_content"]').val(),o=a('[name="gpr_widget_hide_header"]').is(":checked"),p=a('[name="gpr_widget_hide_google_image"]').is(":checked"),q=a('[name="gpr_widget_hide_out_of_rating"]').is(":checked"),r=a('[name="gpr_widget_no_follow"]').is(":checked"),s=a('[name="gpr_widget_target_blank"]').is(":checked"),t=a('[name="gpr_widget_cache"]').val();return""===e?(alert("Missing Location's Place ID. Did you lookup a location?"),!1):(c="["+d.shortcode,e&&(c+=' id="'+e+'"'),f&&(c+=' title="'+f+'"'),"Minimal Light"!==g&&(c+=' widget_style="'+g+'"'),"none"!==h&&(c+=' align="'+h+'"'),""!==i&&"250px"!==i&&(c+=' max_width="'+i+'"'),""!==m&&(c+=' pre_content="'+m+'"'),"5"!==j&&(c+=' review_limit="'+j+'"'),""!==k&&"250"!==k&&(c+=' review_char_limit="'+k+'"'),"none"!==l&&(c+=' review_filter="'+l+'"'),""!==m&&(c+=' pre_content="'+m+'"'),""!==n&&(c+=' post_content="'+n+'"'),""!==t&&"2 Days"!==t&&(c+=' cache="'+t+'"'),1==o&&(c+=' hide_header="true"'),1==p&&(c+=' hide_google_image="true"'),1==q&&(c+=' hide_out_of_rating="true"'),r!==!0&&(c+=' no_follow="false"'),s!==!0&&(c+=' target_blank="false"'),c+="]",top.tinyMCE.activeEditor.execCommand("mceInsertContent",0,c),void top.tinymce.activeEditor.windowManager.close())})}function h(a,b){return b=new RegExp(b+'="([^"]+)"',"g").exec(a),b?window.decodeURIComponent(b[1]):""}var i="",j=!1;a(document).ready(function(){a("#gpr_cancel").on("click",function(a){top.tinymce.activeEditor.windowManager.close(),a.preventDefault()}),i=top.tinyMCE.activeEditor.windowManager.getParams(),"undefined"!==i.shortcode_params&&(j=!0),b()})}(jQuery);